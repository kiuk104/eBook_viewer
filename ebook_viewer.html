<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>이북 텍스트 뷰어 v2.0 (Everything URL Protocol)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@400;500;700&family=Nanum+Gothic:wght@400;700;800&family=Nanum+Myeongjo:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="src/css/styles.css">
</head>
<body id="bodyElement" class="theme-light min-h-screen">
    <div class="viewer-container">
        <div class="bg-white shadow-lg mb-4">
            <div class="bg-white py-8 px-6 border-b-2 border-gray-200" id="uploadHeaderSection">
                <h1 class="text-4xl font-bold text-center mb-2">📚 이북 텍스트 뷰어</h1>
                <p class="text-center text-gray-600">로컬 텍스트 파일을 업로드하여 정리하고 읽어보세요</p>
            </div>

            <div id="page-upload" class="page-section active">
                <div class="relative p-8 bg-white border-b-2 border-gray-200" id="uploadAreaContainer">
                    <button onclick="toggleUploadSection()" class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-semibold transition-colors z-10" id="uploadToggleBtn">
                        <span id="uploadToggleIcon" style="pointer-events: none;">▲</span> 접기
                    </button>
                    <div class="max-w-2xl mx-auto" id="uploadSectionContent">
                        <div id="uploadBox" class="border-2 border-dashed border-gray-300 rounded-xl p-12 text-center bg-white cursor-pointer hover:border-gray-400 hover:bg-gray-50 transition-all duration-300">
                            <input type="file" id="fileInput" accept=".txt,.text,.md,text/plain,text/markdown" multiple class="hidden">
                            <div class="text-6xl mb-4">📁</div>
                            <h2 class="text-2xl font-semibold text-gray-700 mb-2">파일 선택 또는 드래그 앤 드롭</h2>
                            <p class="text-gray-500 mb-6">텍스트 파일(.txt)을 여러 개 선택할 수 있습니다</p>
                            <div class="flex gap-4 justify-center">
                                <button onclick="selectFiles()" class="bg-gray-800 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-700 transition-all duration-200">파일 선택</button>
                                <button onclick="loadGoogleDriveFiles()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-all duration-200 flex items-center gap-2">Google Drive</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-6 bg-white" id="uploadHistoryBookmarksSection">
                    <div class="max-w-6xl mx-auto">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg shadow-md p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">🕐 최근 읽은 파일</h3>
                                <div id="uploadHistoryList" class="space-y-2 max-h-[400px] overflow-y-auto"></div>
                                <div id="uploadHistoryEmpty" class="text-center text-gray-400 py-8">히스토리가 없습니다</div>
                            </div>
                            <div class="bg-white rounded-lg shadow-md p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">⭐ 북마크</h3>
                                <div id="uploadBookmarksList" class="space-y-2 max-h-[400px] overflow-y-auto"></div>
                                <div id="uploadBookmarksEmpty" class="text-center text-gray-400 py-8">북마크가 없습니다</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="mainContent" class="hidden" style="min-height: 400px; background-color: #ffffff;">
                    <div class="p-6">
                        <div class="w-full">
                            <div class="bg-white rounded-lg shadow-md p-6">
                                <div id="viewerHeader" class="mb-4 pb-4 border-b border-gray-200">
                                    <div class="flex items-center justify-between mb-2">
                                        <h2 class="text-2xl font-bold text-gray-800" id="currentFileName">파일을 선택하세요</h2>
                                        <div class="flex gap-2">
                                            <button id="wrapModeBtn" onclick="toggleWrapMode()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm font-semibold">줄바꿈: 자동</button>
                                            <button id="aiCleanBtn" onclick="handleAIClean()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors text-sm font-semibold">🤖 AI 변환 & 저장</button>
                                            <button id="downloadMdBtn" onclick="downloadAsMarkdown()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm font-semibold">💾 MD 저장</button>
                                            <button id="bookmarkBtn" onclick="toggleBookmark()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-colors text-sm font-semibold">⭐ 북마크</button>
                                            <button id="settingsBtn" onclick="toggleSettings()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm font-semibold">⚙️ 설정</button>
                                        </div>
                                    </div>
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 text-sm text-gray-500">
                                        <span id="fileInfo"></span>
                                    </div>
                                </div>
                                
                                <div id="settingsPanel" class="hidden mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200 settings-panel">
                                    <h3 class="text-lg font-bold text-gray-800 mb-4">📝 읽기 설정</h3>
                                    <div class="mb-6">
                                        <label class="block text-sm font-medium text-gray-700 mb-3">색상 테마</label>
                                        <div class="grid grid-cols-5 gap-3">
                                            <div class="theme-option p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-800 active" data-theme="light" onclick="setTheme('light')">☀️ 라이트</div>
                                            <div class="theme-option p-3 rounded-lg border-2 border-gray-300 bg-gray-800 text-white" data-theme="dark" onclick="setTheme('dark')">🌙 다크</div>
                                            <div class="theme-option p-3 rounded-lg border-2 border-gray-300 bg-amber-50 text-amber-900" data-theme="sepia" onclick="setTheme('sepia')">📜 세피아</div>
                                            <div class="theme-option p-3 rounded-lg border-2 border-gray-300 bg-green-50 text-green-900" data-theme="green" onclick="setTheme('green')">🌿 그린</div>
                                            <div class="theme-option p-3 rounded-lg border-2 border-gray-300 bg-gradient-to-br from-purple-400 to-pink-400 text-white" data-theme="custom" onclick="setTheme('custom')">🎨 사용자 지정</div>
                                        </div>
                                    </div>
                                    <div id="customThemeSection" class="mb-6 p-4 bg-purple-50 rounded-lg border-2 border-purple-200 hidden">
                                        <h4 class="text-md font-bold text-purple-800 mb-3">🎨 사용자 지정 테마</h4>
                                        <div class="mb-3">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">배경색</label>
                                            <input type="color" id="customBgColor" value="#ffffff" class="w-full h-10 rounded-lg border border-gray-300 cursor-pointer" onchange="updateCustomTheme()">
                                        </div>
                                        <div class="mb-3">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">글자색</label>
                                            <input type="color" id="customTextColor" value="#1f2937" class="w-full h-10 rounded-lg border border-gray-300 cursor-pointer" onchange="updateCustomTheme()">
                                        </div>
                                    </div>
                                    <div class="mb-6">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">글씨 크기: <span id="fontSizeValue">16</span>px</label>
                                        <input type="range" id="fontSizeSlider" min="12" max="32" value="16" step="1" oninput="setFontSize(this.value)" class="w-full">
                                    </div>
                                    
                                    <div class="mb-6 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                        <h4 class="text-md font-bold text-blue-800 mb-3">☁️ Google Drive 설정</h4>
                                        <div class="mb-3">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">클라이언트 ID</label>
                                            <input type="text" id="googleClientId" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                        </div>
                                        <div class="mb-3">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">API 키</label>
                                            <input type="text" id="googleApiKey" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="saveGoogleDriveSettings()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">✓ 저장</button>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-6 p-4 bg-purple-50 rounded-lg border-2 border-purple-200">
                                        <h4 class="text-md font-bold text-purple-800 mb-3">🤖 AI 설정 (Google Gemini)</h4>
                                        <div class="mb-3">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Google Gemini API Key</label>
                                            <input type="password" id="geminiApiKey" placeholder="AI Studio에서 발급받은 키 입력" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                            <p class="text-xs text-gray-500 mt-1">
                                                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-500 underline">키 발급받기 (무료)</a>
                                            </p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="saveGeminiApiKey()" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm">✓ 저장</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="viewerContent" class="ebook-content text-gray-700" style="min-height: 400px;">
                                    <div id="viewerEmptyState" class="text-center text-gray-400 py-20 cursor-pointer hover:bg-gray-50 rounded-xl">
                                        <div class="text-6xl mb-4">📁</div>
                                        <p class="text-xl font-semibold mb-2">파일 선택 또는 드래그 앤 드롭</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4 text-center text-gray-500 text-sm opacity-80 pb-4">
            <p id="app-info"></p>
        </div>
    </div>

    <!-- ES6 모듈 스크립트 -->
    <script type="module" src="src/js/main.js"></script>
</body>
</html>