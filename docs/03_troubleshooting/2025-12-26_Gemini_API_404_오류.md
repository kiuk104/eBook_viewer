# Google Gemini API 404 오류 해결

**날짜**: 2025-12-26  
**상태**: ✅ 해결 완료  
**영향 범위**: AI 변환 기능

---

## 문제 (Symptoms)

AI 변환 기능 사용 시 Google Gemini API 호출에서 404 Not Found 오류가 발생했습니다.

### 증상

1. **초기 오류**: `gemini-1.5-flash` 모델 사용 시 404 오류
   ```
   HTTP 404: Model not found
   ```

2. **재시도 오류**: `gemini-1.5-flash-latest` 모델로 변경 후에도 동일한 404 오류 발생
   ```
   HTTP 404: Model not found
   ```

3. **사용자 영향**
   - AI 변환 기능이 완전히 작동하지 않음
   - 사용자가 텍스트를 마크다운으로 변환할 수 없음
   - 오류 메시지가 사용자에게 표시됨

---

## 원인 (Root Cause)

### 근본 원인

Google Gemini API의 모델 정책 변경으로 인해 별칭(Alias) 모델명이 폐기되었습니다.

1. **별칭 모델의 폐기**
   - `gemini-1.5-flash`: 일반 별칭으로, 특정 버전을 가리키지 않음
   - `gemini-1.5-flash-latest`: "latest" 별칭이 폐기됨
   - Google은 안정적인 버전 지정을 권장

2. **API 정책 변경**
   - Google이 모델 버전 관리를 더 엄격하게 변경
   - 별칭 대신 구체적인 버전 번호 사용을 요구
   - 예: `gemini-1.5-flash-002` (구체적인 버전)

3. **코드 위치**
   - `src/js/ai_service.js`의 `tryModel()` 함수에서 모델명 사용
   - 초기에는 `gemini-1.5-flash` 사용
   - 첫 번째 수정에서 `gemini-1.5-flash-latest`로 변경했으나 여전히 404 오류 발생

---

## 해결 (Solution)

### 해결 과정

1. **모델명 변경**
   - 안정적인 최신 버전인 `gemini-1.5-flash-002`로 변경
   - 구체적인 버전 번호를 사용하여 API 호출 안정성 확보

2. **재시도 로직 추가**
   - 기본 모델(`gemini-1.5-flash-002`) 실패 시 대체 모델(`gemini-2.0-flash-exp`)로 자동 재시도
   - 사용자 경험 개선 및 안정성 향상

### 수정된 코드

```68:82:src/js/ai_service.js
// 먼저 gemini-1.5-flash-002 시도
try {
    return await tryModel('gemini-1.5-flash-002');
} catch (error) {
    console.warn(`gemini-1.5-flash-002 모델 호출 실패: ${error.message}`);
    
    // 실패 시 gemini-2.0-flash-exp로 재시도
    if(onProgress) onProgress("대체 모델로 재시도 중...");
    try {
        return await tryModel('gemini-2.0-flash-exp');
    } catch (retryError) {
        console.error(`gemini-2.0-flash-exp 모델 호출도 실패: ${retryError.message}`);
        throw new Error(`모든 모델 호출 실패. 마지막 오류: ${retryError.message}`);
    }
}
```

### 변경 사항

1. **모델명 변경**
   - ❌ `gemini-1.5-flash` (별칭, 폐기됨)
   - ❌ `gemini-1.5-flash-latest` (별칭, 폐기됨)
   - ✅ `gemini-1.5-flash-002` (구체적인 버전, 안정적)

2. **재시도 메커니즘 추가**
   - 기본 모델 실패 시 자동으로 대체 모델 시도
   - 사용자에게 진행 상황 알림 (`onProgress` 콜백)

---

## 결과 (Result)

### 해결 확인

1. **기능 정상 작동**
   - `gemini-1.5-flash-002` 모델로 API 호출 성공
   - AI 변환 기능이 정상적으로 작동

2. **안정성 향상**
   - 재시도 로직으로 일시적인 오류에 대한 대응력 향상
   - 사용자 경험 개선 (자동 재시도)

3. **에러 처리 개선**
   - 명확한 에러 메시지 제공
   - 콘솔 로그를 통한 디버깅 정보 제공

### 검증 방법

1. AI 변환 버튼 클릭
2. 텍스트 변환 성공 확인
3. 마크다운 파일 다운로드 확인
4. 브라우저 콘솔에서 오류 없음 확인

---

## 교훈 (Lessons Learned)

1. **API 버전 관리**
   - 별칭 모델명보다 구체적인 버전 번호 사용 권장
   - API 제공자의 정책 변경에 주의

2. **에러 처리**
   - 재시도 로직 구현으로 안정성 향상
   - 사용자에게 명확한 피드백 제공

3. **문서화의 중요성**
   - 문제 해결 과정을 기록하여 향후 유사한 문제 대응 시간 단축

---

## 관련 파일

- `src/js/ai_service.js` - AI 서비스 모듈 (모델명 및 재시도 로직)
- `CHANGELOG.md` - 버전 변경 이력

---

**해결자**: AI Assistant  
**검증자**: 사용자 확인 완료

