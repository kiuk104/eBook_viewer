# í•˜ì´ë¼ì´íŠ¸ ë° ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ê°œì„ 

**ë‚ ì§œ**: 2026-01-02  
**ë²„ì „**: v0.2.3+  
**ì‘ì„±ì**: Claude AI  
**ìƒíƒœ**: í•´ê²°ë¨ âœ…

---

## ğŸ“‹ ëª©ì°¨
1. [í•˜ì´ë¼ì´íŠ¸ í´ë¦­ ì‹œ ìë™ ì„ íƒ ê¸°ëŠ¥](#1-í•˜ì´ë¼ì´íŠ¸-í´ë¦­-ì‹œ-ìë™-ì„ íƒ-ê¸°ëŠ¥)
2. [ì»¤ìŠ¤í…€ ë©”ë‰´ ë¹„í™œì„±í™” ì‹œ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ ë¯¸í‘œì‹œ ë¬¸ì œ](#2-ì»¤ìŠ¤í…€-ë©”ë‰´-ë¹„í™œì„±í™”-ì‹œ-ë¸Œë¼ìš°ì €-ê¸°ë³¸-ë©”ë‰´-ë¯¸í‘œì‹œ-ë¬¸ì œ)
3. [í† ê¸€ UI ë™ê¸°í™” ë¬¸ì œ](#3-í† ê¸€-ui-ë™ê¸°í™”-ë¬¸ì œ)
4. [Ctrl + ìš°í´ë¦­ìœ¼ë¡œ ë¸Œë¼ìš°ì € ë©”ë‰´ ì ‘ê·¼](#4-ctrl--ìš°í´ë¦­ìœ¼ë¡œ-ë¸Œë¼ìš°ì €-ë©”ë‰´-ì ‘ê·¼)
5. [íŒŒì¼ ì¶œì²˜ ì‹œê°ì  êµ¬ë¶„ ê¸°ëŠ¥](#5-íŒŒì¼-ì¶œì²˜-ì‹œê°ì -êµ¬ë¶„-ê¸°ëŠ¥)

---

## 1. í•˜ì´ë¼ì´íŠ¸ í´ë¦­ ì‹œ ìë™ ì„ íƒ ê¸°ëŠ¥

### ğŸ› ì´ìŠˆ
- í•˜ì´ë¼ì´íŠ¸ëœ í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í–ˆì„ ë•Œ í•´ë‹¹ ì˜ì—­ì´ ìë™ìœ¼ë¡œ ì„ íƒë˜ì§€ ì•ŠìŒ
- ì‚¬ìš©ìê°€ í•˜ì´ë¼ì´íŠ¸ ìƒ‰ìƒì„ ë³€ê²½í•˜ë ¤ë©´ ë‹¤ì‹œ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ì•¼ í•¨

### âœ… í•´ê²° ë°©ë²•

**íŒŒì¼:** `src/js/viewer.js`

**ìˆ˜ì • ìœ„ì¹˜:** `handleHighlightClick()` í•¨ìˆ˜

```javascript
// í•˜ì´ë¼ì´íŠ¸ í´ë¦­ í•¸ë“¤ëŸ¬
function handleHighlightClick(e) {
    e.stopPropagation();
    e.preventDefault();
    const targetSpan = e.target;
    const highlightId = targetSpan.dataset.highlightId;
    if (!highlightId) return;

    const relatedSpans = document.querySelectorAll(`span[data-highlight-id="${highlightId}"]`);
    activeHighlightSpan = targetSpan; 
    const selectedText = Array.from(relatedSpans).map(s => s.innerText || s.textContent || '').join('');
    
    // â­ ì¶”ê°€ëœ ì½”ë“œ: í•˜ì´ë¼ì´íŠ¸ëœ ì˜ì—­ì„ ìë™ìœ¼ë¡œ ì„ íƒ
    const selection = window.getSelection();
    selection.removeAllRanges();
    
    if (relatedSpans.length > 0) {
        const range = document.createRange();
        const firstSpan = relatedSpans[0];
        const lastSpan = relatedSpans[relatedSpans.length - 1];
        
        try {
            range.setStartBefore(firstSpan);
            range.setEndAfter(lastSpan);
            selection.addRange(range);
            lastSelectionRange = range.cloneRange(); // ì„ íƒ ì˜ì—­ ì €ì¥
            console.log('âœ… í•˜ì´ë¼ì´íŠ¸ í´ë¦­: ì˜ì—­ ìë™ ì„ íƒë¨ (' + selectedText.length + 'ì)');
        } catch (err) {
            console.error('í•˜ì´ë¼ì´íŠ¸ ì˜ì—­ ì„ íƒ ì‹¤íŒ¨:', err);
        }
    }
    
    // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ
    const contextMenu = document.getElementById('contextMenu');
    if (contextMenu) {
        contextMenu.dataset.selectedText = selectedText;
        toggleMenuMode(true);
        showMenuAt(e.clientX, e.clientY);
    }
}
```

**ì£¼ìš” ë³€ê²½ ì‚¬í•­:**
- `window.getSelection()` API ì‚¬ìš©í•˜ì—¬ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì„ íƒ
- `document.createRange()`ë¡œ ë²”ìœ„ ìƒì„±
- `range.setStartBefore()` / `range.setEndAfter()`ë¡œ í•˜ì´ë¼ì´íŠ¸ ì „ì²´ ì˜ì—­ ì„ íƒ
- `lastSelectionRange`ì— ì €ì¥í•˜ì—¬ ìƒ‰ìƒ ë³€ê²½ ì‹œ ì‚¬ìš©

---

## 2. ì»¤ìŠ¤í…€ ë©”ë‰´ ë¹„í™œì„±í™” ì‹œ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ ë¯¸í‘œì‹œ ë¬¸ì œ

### ğŸ› ì´ìŠˆ #1: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ í•­ìƒ ë“±ë¡ë¨
- ì»¤ìŠ¤í…€ ë©”ë‰´ë¥¼ ë¹„í™œì„±í™”í•´ë„ `contextmenu` ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ë“±ë¡ë˜ì–´ ìˆìŒ
- ì´ë²¤íŠ¸ê°€ ê°€ë¡œì±„ì ¸ì„œ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

### âœ… í•´ê²° ë°©ë²• #1

**íŒŒì¼:** `src/js/viewer.js`

**ìˆ˜ì • ìœ„ì¹˜:** `setupContextMenuListener()` í•¨ìˆ˜

```javascript
function setupContextMenuListener() {
    const viewerContent = document.getElementById('viewerContent');
    const contextMenu = document.getElementById('contextMenu');
    if (!viewerContent || !contextMenu) return;
    
    // ë¨¼ì € ì„¤ì • ë³µì› (ì¤‘ìš”: ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì „ì— ì‹¤í–‰)
    restoreContextMenuSetting();
    
    // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±°
    viewerContent.removeEventListener('contextmenu', handleContextMenu);
    viewerContent.removeEventListener('mouseup', handleMouseUp);
    document.removeEventListener('click', hideContextMenu);
    
    // â­ ì»¤ìŠ¤í…€ ë©”ë‰´ê°€ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    const isEnabled = localStorage.getItem('contextMenuEnabled') !== 'false';
    
    if (isEnabled) {
        viewerContent.addEventListener('contextmenu', handleContextMenu);
        document.addEventListener('click', hideContextMenu);
        viewerContent.addEventListener('mouseup', handleMouseUp);
        console.log('âœ… ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í™œì„±í™”ë¨');
    } else {
        console.log('âš ï¸ ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë¹„í™œì„±í™”ë¨ - ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ ì‚¬ìš©');
    }
    
    // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
}

// mouseup í•¸ë“¤ëŸ¬ë¥¼ ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
function handleMouseUp() {
    const selection = window.getSelection();
    if (selection && selection.rangeCount > 0 && selection.toString().trim().length > 0) {
        lastSelectionRange = selection.getRangeAt(0).cloneRange();
        console.log('âœ… mouseup: ì„ íƒ ì˜ì—­ ìë™ ì €ì¥ë¨ (' + selection.toString().trim().length + 'ì)');
    }
}
```

**ì£¼ìš” ë³€ê²½ ì‚¬í•­:**
- ì„¤ì • í™•ì¸ í›„ ì¡°ê±´ë¶€ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
- `mouseup` í•¸ë“¤ëŸ¬ë¥¼ ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•˜ì—¬ ì¡°ê±´ë¶€ ë“±ë¡
- ë¹„í™œì„±í™” ì‹œ ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°

---

## 3. í† ê¸€ UI ë™ê¸°í™” ë¬¸ì œ

### ğŸ› ì´ìŠˆ #2: í† ê¸€ í´ë¦­í•´ë„ UIê°€ ë³€ê²½ë˜ì§€ ì•ŠìŒ
- ì„¤ì • íŒ¨ë„ê³¼ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ì— ê°ê° í† ê¸€ì´ ìˆìŒ (`ctxMenuSettingsToggle`, `ctxMenuInternalToggle`)
- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ì˜ í† ê¸€ì— `onchange` ì´ë²¤íŠ¸ê°€ ì—†ì–´ì„œ í´ë¦­í•´ë„ ì‘ë™ ì•ˆ í•¨
- JavaScriptì—ì„œ `checked` ì†ì„±ë§Œ ë³€ê²½í•´ë„ Tailwind CSSì˜ `peer-checked` ìƒíƒœê°€ ì—…ë°ì´íŠ¸ ì•ˆ ë¨

### âœ… í•´ê²° ë°©ë²• #2

**íŒŒì¼:** `ebook_viewer.html`

```html
<!-- ì„¤ì • íŒ¨ë„ì˜ í† ê¸€ (190ë²ˆ ì¤„) -->
<input type="checkbox" id="ctxMenuSettingsToggle" class="sr-only peer" checked 
       onchange="toggleContextMenuSetting('ctxMenuSettingsToggle')">

<!-- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ì˜ í† ê¸€ (366ë²ˆ ì¤„) -->
<input type="checkbox" id="ctxMenuInternalToggle" class="sr-only peer" checked 
       onchange="toggleContextMenuSetting('ctxMenuInternalToggle')">
```

**íŒŒì¼:** `src/js/viewer.js`

```javascript
export function toggleContextMenuSetting(toggleId) {
    const toggleSettings = document.getElementById('ctxMenuSettingsToggle');
    const toggleInternal = document.getElementById('ctxMenuInternalToggle');
    
    // í´ë¦­ëœ í† ê¸€ì˜ ìƒíƒœë¥¼ ê°€ì ¸ì˜´
    const clickedToggle = document.getElementById(toggleId);
    const enabled = clickedToggle ? clickedToggle.checked : true;
    
    console.log(`ğŸ”„ í† ê¸€ í´ë¦­: ${toggleId}, ìƒˆ ê°’: ${enabled}`);
    
    // localStorageì— ì €ì¥
    localStorage.setItem('contextMenuEnabled', enabled.toString());
    
    // ë‘ í† ê¸€ ëª¨ë‘ ë™ê¸°í™”
    if (toggleSettings) toggleSettings.checked = enabled;
    if (toggleInternal) toggleInternal.checked = enabled;
    
    // ì„¤ì • ë³€ê²½ ì‹œ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡
    setupContextMenuListener();
    console.log(`âœ… ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì„¤ì • ì™„ë£Œ: ${enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`);
}

export function restoreContextMenuSetting() {
    const enabled = localStorage.getItem('contextMenuEnabled') !== 'false';
    
    // ë‘ í† ê¸€ ëª¨ë‘ ë™ê¸°í™”
    const toggleSettings = document.getElementById('ctxMenuSettingsToggle');
    const toggleInternal = document.getElementById('ctxMenuInternalToggle');
    
    if (toggleSettings) toggleSettings.checked = enabled;
    if (toggleInternal) toggleInternal.checked = enabled;
    
    console.log(`ğŸ”„ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì„¤ì • ë³µì›: ${enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`);
}
```

**ì£¼ìš” ë³€ê²½ ì‚¬í•­:**
- HTMLì—ì„œ í† ê¸€ IDë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
- í´ë¦­ëœ í† ê¸€ì˜ ìƒíƒœë¥¼ ì •í™•íˆ ê°€ì ¸ì˜´
- ë‘ í† ê¸€ì„ í•­ìƒ ë™ê¸°í™”
- ì„¤ì • ë³µì› ì‹œ ë‘ í† ê¸€ ëª¨ë‘ ì—…ë°ì´íŠ¸

---

## 4. Ctrl + ìš°í´ë¦­ìœ¼ë¡œ ë¸Œë¼ìš°ì € ë©”ë‰´ ì ‘ê·¼

### ğŸ› ì´ìŠˆ #3: ì»¤ìŠ¤í…€ ë©”ë‰´ ì‚¬ìš© ì¤‘ ë¸Œë¼ìš°ì € ë©”ë‰´ ì ‘ê·¼ ë°©ë²• ë¶€ì¬
- ì»¤ìŠ¤í…€ ë©”ë‰´ê°€ í™œì„±í™”ë˜ë©´ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´(ë³µì‚¬, ê²€ìƒ‰, ë²ˆì—­ ë“±)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
- í† ê¸€ì„ OFF/ON ë°˜ë³µí•˜ëŠ” ê²ƒì€ ë¶ˆí¸í•¨

### âš ï¸ ì‹œë„í–ˆìœ¼ë‚˜ ì‹¤íŒ¨í•œ ë°©ë²•
1. **ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ë¸Œë¼ìš°ì € ë©”ë‰´ ì—´ê¸°:** ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…ìƒ JavaScriptë¡œ `contextmenu` ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œë„ ê¸°ë³¸ ë©”ë‰´ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ
2. **Shift + ìš°í´ë¦­:** Shift + í´ë¦­ì€ ë¸Œë¼ìš°ì €ì—ì„œ "ì„ íƒ ì˜ì—­ í™•ì¥"ì´ë¼ëŠ” ê¸°ë³¸ ë™ì‘ì´ ìˆì–´ì„œ ì„ íƒ ì˜ì—­ì´ ë³€ê²½ë¨

### âœ… ìµœì¢… í•´ê²° ë°©ë²•

**Ctrl + ìš°í´ë¦­** (Macì€ Cmd + ìš°í´ë¦­) ì‚¬ìš©

**íŒŒì¼:** `src/js/viewer.js`

**ìˆ˜ì • ìœ„ì¹˜:** `handleContextMenu()` í•¨ìˆ˜

```javascript
function handleContextMenu(e) {
    const viewerContent = document.getElementById('viewerContent');
    const contextMenu = document.getElementById('contextMenu');
    const selection = window.getSelection();
    
    if (!viewerContent.contains(e.target)) {
        hideContextMenu();
        return;
    }

    // â­ Ctrl í‚¤(Windows/Linux) ë˜ëŠ” Cmd í‚¤(Mac)ë¥¼ ëˆ„ë¥´ê³  ìš°í´ë¦­í•˜ë©´ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ í‘œì‹œ
    if (e.ctrlKey || e.metaKey) {
        console.log('ğŸŒ Ctrl + ìš°í´ë¦­: ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ í‘œì‹œ');
        hideContextMenu();
        return; // ê¸°ë³¸ ë™ì‘ í—ˆìš© (e.preventDefault() í˜¸ì¶œ ì•ˆ í•¨)
    }

    // ... ë‚˜ë¨¸ì§€ ì»¤ìŠ¤í…€ ë©”ë‰´ ë¡œì§
}
```

**íŒŒì¼:** `ebook_viewer.html`

**UI íŒíŠ¸ ì¶”ê°€:**

```html
<div class="px-3 py-2 border-t theme-border bg-blue-50/30">
    <div class="text-[10px] text-blue-600 text-center leading-tight">
        ğŸ’¡ <span class="font-semibold">Ctrl + ìš°í´ë¦­</span>í•˜ë©´ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´
    </div>
</div>
```

**ì‚¬ìš© ë°©ë²•:**
- **ì¼ë°˜ ìš°í´ë¦­:** ì»¤ìŠ¤í…€ ë©”ë‰´ (í•˜ì´ë¼ì´íŠ¸, ë¶ë§ˆí¬ ë“±)
- **Ctrl + ìš°í´ë¦­:** ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ (ë³µì‚¬, ê²€ìƒ‰, ë²ˆì—­ ë“±)

**ì¥ì :**
- âœ… ê°„ë‹¨í•˜ê³  ì§ê´€ì 
- âœ… ì„ íƒ ì˜ì—­ì´ ë³€ê²½ë˜ì§€ ì•ŠìŒ
- âœ… Windows/Linux/Mac ëª¨ë‘ ì§€ì› (e.metaKey)
- âœ… ë§ì€ ì•±ì—ì„œ ì‚¬ìš©í•˜ëŠ” í‘œì¤€ íŒ¨í„´

---

## 5. íŒŒì¼ ì¶œì²˜ ì‹œê°ì  êµ¬ë¶„ ê¸°ëŠ¥

### ğŸ¯ ìš”êµ¬ì‚¬í•­
- íˆìŠ¤í† ë¦¬ì™€ ë¶ë§ˆí¬ ëª©ë¡ì—ì„œ íŒŒì¼ì´ ë¡œì»¬ íŒŒì¼ì¸ì§€ Google Drive íŒŒì¼ì¸ì§€ êµ¬ë¶„ í•„ìš”
- ì•„ì´ì½˜ê³¼ ìƒ‰ìƒìœ¼ë¡œ ì‹œê°ì  ì°¨ë³„í™”

### âœ… í•´ê²° ë°©ë²•

**íŒŒì¼:** `src/js/viewer.js`

#### 5.1 íˆìŠ¤í† ë¦¬ ëª©ë¡ (`displayUploadHistory()` í•¨ìˆ˜)

```javascript
export function displayUploadHistory() { 
    const historyList = document.getElementById('uploadHistoryList');
    if(!historyList) return;
    const history = getHistory();
    historyList.innerHTML = '';
    
    if (history.length === 0) {
        document.getElementById('uploadHistoryEmpty').style.display = 'block';
        return;
    }
    document.getElementById('uploadHistoryEmpty').style.display = 'none';

    history.forEach((item, index) => {
        // â­ íŒŒì¼ ì¶œì²˜ í™•ì¸
        const isGoogleDrive = item.fileKey.startsWith('gdrive_');
        const isMdFile = item.name.endsWith('.md');
        
        // â­ ì•„ì´ì½˜ê³¼ ìƒ‰ìƒ ì„¤ì •
        let icon, iconColor, borderColor;
        if (isGoogleDrive) {
            icon = isMdFile ? 'ğŸ“' : 'ğŸ“„';
            iconColor = 'text-blue-600'; // Google Drive íŒŒì¼ì€ íŒŒë€ìƒ‰
            borderColor = 'border-l-4 border-blue-500';
        } else {
            icon = isMdFile ? 'ğŸ“' : 'ğŸ“„';
            iconColor = 'text-gray-600'; // ë¡œì»¬ íŒŒì¼ì€ íšŒìƒ‰
            borderColor = 'border-l-4 border-gray-400';
        }
        
        const div = document.createElement('div');
        div.className = `flex items-center justify-between py-1 px-2 rounded cursor-pointer transition-colors leading-tight theme-item-bg group ${borderColor}`;
        
        // â­ Google Drive ë±ƒì§€ ì¶”ê°€
        const badge = isGoogleDrive 
            ? '<span class="text-[8px] bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded font-semibold">Drive</span>' 
            : '<span class="text-[8px] bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded font-semibold">Local</span>';
        
        const infoDiv = document.createElement('div');
        infoDiv.className = 'flex items-center gap-2 overflow-hidden flex-1 pr-2';
        infoDiv.innerHTML = `<span class="text-lg ${iconColor}">${icon}</span><div class="flex flex-col overflow-hidden leading-tight flex-1"><div class="flex items-center gap-1.5"><span class="font-medium truncate text-sm theme-text-body">${item.name}</span>${badge}</div><span class="text-[10px] theme-text-body opacity-70">${formatTimestamp(item.timestamp)}</span></div>`;
        
        // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
    });
}
```

**ì‹œê°ì  êµ¬ë¶„ ìš”ì†Œ:**
- **Google Drive:** íŒŒë€ìƒ‰ ì•„ì´ì½˜ + íŒŒë€ìƒ‰ ì™¼ìª½ í…Œë‘ë¦¬ + "Drive" ë±ƒì§€
- **ë¡œì»¬ íŒŒì¼:** íšŒìƒ‰ ì•„ì´ì½˜ + íšŒìƒ‰ ì™¼ìª½ í…Œë‘ë¦¬ + "Local" ë±ƒì§€

#### 5.2 ë¶ë§ˆí¬ ëª©ë¡ (`displayUploadBookmarks()` í•¨ìˆ˜)

```javascript
export function displayUploadBookmarks() { 
    const list = document.getElementById('uploadBookmarksList');
    if(!list) return;
    const bookmarks = getBookmarks();
    const current = currentFileKey && bookmarks[currentFileKey] ? bookmarks[currentFileKey] : [];
    list.innerHTML = '';
    
    if (!currentFileKey || current.length === 0) {
        document.getElementById('uploadBookmarksEmpty').style.display = 'block';
        return;
    }
    document.getElementById('uploadBookmarksEmpty').style.display = 'none';

    // â­ í˜„ì¬ íŒŒì¼ì´ Google Drive íŒŒì¼ì¸ì§€ í™•ì¸
    const isGoogleDrive = currentFileKey.startsWith('gdrive_');
    const borderColor = isGoogleDrive ? 'border-l-4 border-blue-500' : 'border-l-4 border-gray-400';
    const bookmarkIcon = isGoogleDrive ? 'ğŸ”–' : 'ğŸ“Œ';
    const iconColor = isGoogleDrive ? 'text-blue-600' : 'text-gray-600';

    current.forEach(bm => {
        const div = document.createElement('div');
        div.className = `flex items-center justify-between py-1 px-2 rounded cursor-pointer transition-colors leading-tight theme-item-bg group ${borderColor}`;
        const infoDiv = document.createElement('div');
        infoDiv.className = 'flex flex-col overflow-hidden flex-1 pr-2';
        infoDiv.innerHTML = `<div class="font-medium text-sm truncate leading-tight theme-text-body ${iconColor}"><span class="mr-1">${bookmarkIcon}</span>${bm.preview || 'ë¶ë§ˆí¬'}</div><div class="text-[10px] theme-text-body opacity-70 leading-tight">ìœ„ì¹˜: ${bm.position.toFixed(1)}%</div>`;
        
        // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
    });
}
```

**ì‹œê°ì  êµ¬ë¶„ ìš”ì†Œ:**
- **Google Drive:** ğŸ”– ì•„ì´ì½˜ + íŒŒë€ìƒ‰ í…ìŠ¤íŠ¸ + íŒŒë€ìƒ‰ ì™¼ìª½ í…Œë‘ë¦¬
- **ë¡œì»¬ íŒŒì¼:** ğŸ“Œ ì•„ì´ì½˜ + íšŒìƒ‰ í…ìŠ¤íŠ¸ + íšŒìƒ‰ ì™¼ìª½ í…Œë‘ë¦¬

---

## ğŸ“¦ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

1. **ebook_viewer.html**
   - ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í† ê¸€ì— `onchange` ì´ë²¤íŠ¸ ì¶”ê°€
   - ì„¤ì • íŒ¨ë„ í† ê¸€ì— íŒŒë¼ë¯¸í„° ì „ë‹¬
   - Ctrl + ìš°í´ë¦­ íŒíŠ¸ ì¶”ê°€

2. **src/js/viewer.js**
   - `handleHighlightClick()`: í•˜ì´ë¼ì´íŠ¸ í´ë¦­ ì‹œ ìë™ ì„ íƒ
   - `setupContextMenuListener()`: ì¡°ê±´ë¶€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
   - `handleMouseUp()`: ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
   - `handleContextMenu()`: Ctrl í‚¤ ê°ì§€ ë¡œì§ ì¶”ê°€
   - `toggleContextMenuSetting()`: íŒŒë¼ë¯¸í„°ë¡œ í† ê¸€ ID ë°›ê¸°
   - `restoreContextMenuSetting()`: ë‘ í† ê¸€ ë™ê¸°í™”
   - `displayUploadHistory()`: íŒŒì¼ ì¶œì²˜ ì‹œê°ì  êµ¬ë¶„
   - `displayUploadBookmarks()`: íŒŒì¼ ì¶œì²˜ ì‹œê°ì  êµ¬ë¶„

---

## ğŸ¯ ì‚¬ìš©ì ê²½í—˜ ê°œì„  ìš”ì•½

### Before âŒ
- í•˜ì´ë¼ì´íŠ¸ í´ë¦­ í›„ ìƒ‰ìƒ ë³€ê²½í•˜ë ¤ë©´ ë‹¤ì‹œ í…ìŠ¤íŠ¸ ì„ íƒ í•„ìš”
- ì»¤ìŠ¤í…€ ë©”ë‰´ ë¹„í™œì„±í™”í•´ë„ ë¸Œë¼ìš°ì € ë©”ë‰´ ì•ˆ ë‚˜íƒ€ë‚¨
- í† ê¸€ í´ë¦­í•´ë„ UIê°€ ì•ˆ ë°”ë€œ
- ë¸Œë¼ìš°ì € ë©”ë‰´ ì‚¬ìš©í•˜ë ¤ë©´ í† ê¸€ì„ OFF/ON ë°˜ë³µ
- íŒŒì¼ ì¶œì²˜ë¥¼ ì•Œ ìˆ˜ ì—†ì–´ì„œ í´ë¦­í–ˆì„ ë•Œ ì‘ë™ ì•ˆ í•˜ëŠ” ì´ìœ ë¥¼ ëª¨ë¦„

### After âœ…
- í•˜ì´ë¼ì´íŠ¸ í´ë¦­í•˜ë©´ ìë™ìœ¼ë¡œ ì„ íƒë˜ì–´ ë°”ë¡œ ìƒ‰ìƒ ë³€ê²½ ê°€ëŠ¥
- ì»¤ìŠ¤í…€ ë©”ë‰´ ë¹„í™œì„±í™” ì‹œ ë¸Œë¼ìš°ì € ë©”ë‰´ ì •ìƒ í‘œì‹œ
- í† ê¸€ í´ë¦­í•˜ë©´ ì¦‰ì‹œ UI ë³€ê²½ë˜ê³  ë™ê¸°í™”ë¨
- Ctrl + ìš°í´ë¦­ìœ¼ë¡œ ì–¸ì œë“ ì§€ ë¸Œë¼ìš°ì € ë©”ë‰´ ì‚¬ìš© ê°€ëŠ¥
- ìƒ‰ìƒê³¼ ì•„ì´ì½˜ìœ¼ë¡œ íŒŒì¼ ì¶œì²˜ë¥¼ í•œëˆˆì— íŒŒì•… (Drive/Local)

---

## ğŸš€ ë°°í¬ ë°©ë²•

1. **íŒŒì¼ êµì²´:**
   - `ebook_viewer.html` â†’ í”„ë¡œì íŠ¸ ë£¨íŠ¸
   - `viewer.js` â†’ `src/js/viewer.js`

2. **ë¸Œë¼ìš°ì € ìºì‹œ í´ë¦¬ì–´:**
   - `Ctrl + Shift + R` (í•˜ë“œ ë¦¬í”„ë ˆì‹œ)
   - ë˜ëŠ” `Ctrl + Shift + Delete` â†’ ìºì‹œ ì‚­ì œ

3. **ë™ì‘ í™•ì¸:**
   - í•˜ì´ë¼ì´íŠ¸ í´ë¦­ â†’ ìë™ ì„ íƒ í™•ì¸
   - Ctrl + ìš°í´ë¦­ â†’ ë¸Œë¼ìš°ì € ë©”ë‰´ í™•ì¸
   - í† ê¸€ ON/OFF â†’ UI ë³€ê²½ í™•ì¸
   - íˆìŠ¤í† ë¦¬ ëª©ë¡ â†’ Drive/Local êµ¬ë¶„ í™•ì¸

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

### localStorage í‚¤
- `contextMenuEnabled`: ì»¤ìŠ¤í…€ ë©”ë‰´ í™œì„±í™” ì—¬ë¶€ (`'true'` / `'false'`)

### ì£¼ìš” DOM ìš”ì†Œ ID
- `ctxMenuSettingsToggle`: ì„¤ì • íŒ¨ë„ì˜ í† ê¸€
- `ctxMenuInternalToggle`: ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ì˜ í† ê¸€
- `viewerContent`: ë©”ì¸ ë·°ì–´ ì»¨í…Œì´ë„ˆ
- `contextMenu`: ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´

### íŒŒì¼ í‚¤ êµ¬ì¡°
- Google Drive: `gdrive_{fileId}`
- ë¡œì»¬ íŒŒì¼: `local_{fileName}_{randomId}`

---

## ğŸ” ë””ë²„ê¹… íŒ

### ì½˜ì†” ë¡œê·¸ ë©”ì‹œì§€
```javascript
// ì»¤ìŠ¤í…€ ë©”ë‰´ í™œì„±í™” ì‹œ
"âœ… ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í™œì„±í™”ë¨"

// ì»¤ìŠ¤í…€ ë©”ë‰´ ë¹„í™œì„±í™” ì‹œ
"âš ï¸ ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë¹„í™œì„±í™”ë¨ - ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ ì‚¬ìš©"

// í•˜ì´ë¼ì´íŠ¸ í´ë¦­ ì‹œ
"âœ… í•˜ì´ë¼ì´íŠ¸ í´ë¦­: ì˜ì—­ ìë™ ì„ íƒë¨ (XXì)"

// Ctrl + ìš°í´ë¦­ ì‹œ
"ğŸŒ Ctrl + ìš°í´ë¦­: ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ í‘œì‹œ"

// í† ê¸€ ë³€ê²½ ì‹œ
"ğŸ”„ í† ê¸€ í´ë¦­: ctxMenuSettingsToggle, ìƒˆ ê°’: false"
"âœ… ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì„¤ì • ì™„ë£Œ: ë¹„í™œì„±í™”"
```

### ë¬¸ì œ ë°œìƒ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸
1. âœ… ë¸Œë¼ìš°ì € ìºì‹œ í´ë¦¬ì–´í–ˆëŠ”ê°€?
2. âœ… íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ë³µì‚¬ë˜ì—ˆëŠ”ê°€?
3. âœ… ì½˜ì†”ì— ì—ëŸ¬ ë©”ì‹œì§€ê°€ ìˆëŠ”ê°€?
4. âœ… localStorageì— ì„¤ì •ì´ ì €ì¥ë˜ì–´ ìˆëŠ”ê°€?

---

**ë¬¸ì„œ ë²„ì „:** 1.0  
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2026-01-02  
**ì‘ì„± ë„êµ¬:** Claude AI (Anthropic)

