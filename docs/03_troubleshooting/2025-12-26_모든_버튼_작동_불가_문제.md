# 모든 버튼 작동 불가 문제

**날짜**: 2025-12-26  
**버전**: v0.2.0  
**심각도**: 높음 (Critical)  
**상태**: 해결됨 ✅

---

## 문제 증상

모든 버튼이 작동하지 않는 문제가 발생했습니다. 특히:
- "파일 선택" 버튼 클릭 시 `selectFiles is not defined` 오류
- "Google Drive" 버튼 클릭 시 `loadGoogleDriveFiles is not defined` 오류
- 다른 모든 버튼들도 작동하지 않음

### 브라우저 콘솔 오류

```
main.js:8 Uncaught SyntaxError: The requested module './viewer.js' does not provide an export named 'restoreBodyStyles' (at main.js:8:127)
ebook_viewer.html:39 Uncaught ReferenceError: selectFiles is not defined
    at HTMLButtonElement.onclick (ebook_viewer.html:39:177)
```

---

## 원인 분석

### 원인 1: `restoreBodyStyles` 함수가 export되지 않음

**문제**: `main.js`에서 `restoreBodyStyles`를 `viewer.js`에서 import하려고 했지만, 해당 함수가 export되지 않아 모듈 로딩이 실패했습니다.

```javascript
// main.js:8
import { ..., restoreBodyStyles, ... } from './viewer.js';
// ❌ Error: The requested module './viewer.js' does not provide an export named 'restoreBodyStyles'
```

**근본 원인**: 
- `viewer.js`에 `updateBodyStyles()` 함수는 있었지만 `restoreBodyStyles()` 함수가 없었습니다.
- `displayFileContent()` 내부에서 `restoreBodyStyles()`를 호출하고 있었지만, 함수 정의가 누락되어 있었습니다.

### 원인 2: HTML에 `onclick` 속성이 남아있음

**문제**: `ebook_viewer.html`의 "파일 선택" 및 "Google Drive" 버튼에 `onclick` 속성이 남아있어, 모듈이 로드되기 전에 함수를 호출하려고 시도했습니다.

```html
<!-- ebook_viewer.html:39 -->
<button onclick="selectFiles()" ...>파일 선택</button>
<button onclick="loadGoogleDriveFiles()" ...>Google Drive</button>
```

**근본 원인**:
- ES6 모듈 시스템에서는 모듈이 로드되기 전에 전역 함수가 정의되지 않습니다.
- `onclick` 속성은 HTML 파싱 시점에 평가되므로, 모듈 로딩보다 먼저 실행됩니다.
- `setupButtonEventListeners()` 함수가 `onclick` 속성을 제거하고 이벤트 리스너를 추가하려고 했지만, `onclick` 속성이 남아있어 중복 호출이 발생했습니다.

---

## 해결 과정

### 1단계: `restoreBodyStyles` 함수 추가 및 export

**파일**: `src/js/viewer.js`

`restoreMarkdownStyles()` 함수와 유사한 패턴으로 `restoreBodyStyles()` 함수를 추가했습니다:

```javascript
/**
 * 저장된 본문 스타일 복원
 */
export function restoreBodyStyles() {
    const viewer = document.getElementById('viewerContent');
    if (!viewer) {
        return;
    }
    
    const bodyFont = localStorage.getItem('bodyFontFamily') || "'Noto Sans KR', sans-serif";
    const lineHeight = localStorage.getItem('bodyLineHeight') || '1.8';
    const bodyColor = localStorage.getItem('bodyTextColor') || '#374151';
    
    // UI 업데이트
    const bodyFontSelect = document.getElementById('bodyFontFamily');
    const lineHeightInput = document.getElementById('lineHeightInput') || document.getElementById('lineHeightSlider');
    const lineHeightValue = document.getElementById('lineHeightValue');
    const bodyColorInput = document.getElementById('bodyTextColor');
    
    if (bodyFontSelect) bodyFontSelect.value = bodyFont;
    if (lineHeightInput) lineHeightInput.value = lineHeight;
    if (lineHeightValue) lineHeightValue.textContent = lineHeight;
    if (bodyColorInput) bodyColorInput.value = bodyColor;
    
    // 스타일 적용
    viewer.style.setProperty('--user-line-height', lineHeight);
    viewer.style.fontFamily = bodyFont;
    viewer.style.color = bodyColor;
    
    // 마크다운 모드인 경우 내부 요소에도 적용
    if (viewer.classList.contains('markdown-mode')) {
        const bodyElements = viewer.querySelectorAll('p, li, blockquote, td, th, div');
        bodyElements.forEach(el => {
            el.style.fontFamily = bodyFont;
            el.style.color = bodyColor;
        });
    }
}
```

### 2단계: HTML에서 `onclick` 속성 제거 및 ID 추가

**파일**: `ebook_viewer.html`

`onclick` 속성을 제거하고 고유 ID를 추가했습니다:

```html
<!-- 변경 전 -->
<button onclick="selectFiles()" ...>파일 선택</button>
<button onclick="loadGoogleDriveFiles()" ...>Google Drive</button>

<!-- 변경 후 -->
<button id="selectFilesBtn" ...>파일 선택</button>
<button id="loadGoogleDriveBtn" ...>Google Drive</button>
```

### 3단계: `setupButtonEventListeners` 함수 개선

**파일**: `src/js/main.js`

ID로도 버튼을 찾을 수 있도록 `setupButtonEventListeners()` 함수를 업데이트했습니다:

```javascript
// 파일 선택 버튼 (ID로 찾기)
const selectFilesBtn = document.getElementById('selectFilesBtn') || document.querySelector('button[onclick="selectFiles()"]');

// Google Drive 버튼 (ID로 찾기)
const loadGoogleDriveBtn = document.getElementById('loadGoogleDriveBtn') || document.querySelector('button[onclick="loadGoogleDriveFiles()"]');
```

이렇게 하면:
- ID가 있으면 ID로 찾고, 없으면 `onclick` 속성으로 찾습니다 (하위 호환성).
- `onclick` 속성을 제거하고 이벤트 리스너를 추가합니다.

---

## 해결 결과

✅ 모든 버튼이 정상적으로 작동합니다:
- "파일 선택" 버튼: 파일 선택 다이얼로그가 정상적으로 열림
- "Google Drive" 버튼: Google Drive 파일 선택이 정상적으로 작동
- 다른 모든 버튼들도 정상 작동

✅ 모듈 로딩 오류가 해결되었습니다:
- `restoreBodyStyles` 함수가 정상적으로 export되어 import 가능
- ES6 모듈 시스템이 정상적으로 작동

---

## 교훈 및 향후 개선 사항

### 교훈

1. **ES6 모듈과 `onclick` 속성의 충돌**
   - ES6 모듈을 사용할 때는 HTML의 `onclick` 속성을 사용하지 않는 것이 좋습니다.
   - 대신 JavaScript에서 이벤트 리스너를 동적으로 추가해야 합니다.

2. **함수 export 누락 방지**
   - 다른 모듈에서 import하는 함수는 반드시 `export` 키워드를 사용해야 합니다.
   - TypeScript나 린터를 사용하면 이러한 문제를 사전에 발견할 수 있습니다.

3. **디버깅 전략**
   - 브라우저 콘솔의 오류 메시지를 먼저 확인하는 것이 중요합니다.
   - 모듈 로딩 오류는 다른 모든 기능에 영향을 미치므로 우선순위가 높습니다.

### 향후 개선 사항

1. **린터 설정**
   - ESLint 등을 사용하여 `onclick` 속성 사용을 금지하는 규칙 추가
   - export되지 않은 함수를 import하려고 할 때 경고

2. **타입 체크**
   - TypeScript 도입을 고려하여 타입 안정성 확보
   - 함수 export/import 시 타입 체크

3. **테스트 자동화**
   - 버튼 클릭 기능에 대한 자동화된 테스트 추가
   - 모듈 로딩 오류를 사전에 발견

---

## 관련 파일

- `src/js/main.js`: `setupButtonEventListeners()` 함수
- `src/js/viewer.js`: `restoreBodyStyles()` 함수 추가
- `ebook_viewer.html`: `onclick` 속성 제거 및 ID 추가

---

## 참고 문서

- [ES6 Modules - MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules)
- [Event Listeners vs Inline Handlers](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener)

---

**작성자**: AI Assistant  
**검토일**: 2025-12-26

