# Change Log

모든 주요 변경사항은 이 파일에 기록됩니다.

이 프로젝트는 [Semantic Versioning](https://semver.org/lang/ko/)을 따릅니다.

---

## [v0.2.4.13] - 2026-02-01

### ✨ 추가됨 (Added)
- **편집 패널 UI 대폭 개선**
  - 버튼 재구성: 메모리 저장 / 파일 저장 / 원본으로 / 닫기
  - 중앙 상태 표시 영역 추가 (변경 횟수, 저장 시간 표시)
  - 테두리 추가로 시각적 구분 강화
- **즉시 저장 기능**
  - `saveEditedContentNow()` 메서드 추가
  - 확인 없이 즉시 저장 (메모리)
  - 저장 후 원본 콘텐츠 업데이트
  - 마지막 저장 시간 표시
- **원본 복원 기능**
  - `restoreOriginal()` 메서드 추가
  - 확인 대화상자로 원본으로 되돌리기
  - 편집 히스토리 초기화
- **편집 패널 닫기 기능**
  - `closeEditPanel()` 메서드 추가
  - 변경사항이 있으면 저장 여부 확인
  - 예/아니오/취소 옵션 제공
- **파일 다운로드 기능**
  - `downloadEditedFile()` 메서드 추가
  - 편집 내용을 파일로 다운로드
  - 파일명에 타임스탬프 자동 추가
- **자동 저장 시스템**
  - 5분마다 자동 저장 (`saveEditedContentNow()`)
  - 편집 모드 활성화 시 자동 시작
  - 편집 모드 비활성화 시 자동 정지
- **로컬스토리지 임시 저장**
  - 30초마다 자동 저장 (로컬스토리지)
  - 브라우저 새로고침 시 복원 기능
  - 저장 시각 표시 및 확인 대화상자
  - 편집 모드 종료 시 자동 정리

### 🔧 개선됨 (Improved)
- **편집 상태 표시 개선**
  - 변경 횟수 표시 (`✏️ 수정됨 (3회)`)
  - 마지막 저장 시간 표시 (`✅ 저장됨 (오후 3:45:30)`)
  - 상태별 색상 구분 (저장됨: 초록색, 수정됨: 주황색, 복원됨: 파란색)
- **Ctrl+S 단축키 개선**
  - 즉시 저장으로 변경 (확인 없이)
  - `saveEditedContentNow()` 호출
- **저장 기능 개선**
  - `saveEditedContent()` 메서드 개선
  - 자동 다운로드 기능 추가
  - 파일명에 타임스탬프 자동 추가
  - `alert` 대신 토스트 메시지 사용
  - 에러 처리 개선

### 💄 스타일/UI 개선 (UI/UX)
- **편집 패널 버튼 개선**
  - 메모리 저장 버튼 (초록색)
  - 파일 저장 버튼 (파란색) 추가
  - 원본으로 버튼 (주황색)
  - 닫기 버튼 (빨간색)
  - 각 버튼에 툴팁 추가

---

## [v0.2.4.11] - 2026-02-01

### ✨ 추가됨 (Added)
- **링크 수정 및 삭제 기능**
  - **더블클릭으로 링크 수정**
    - 링크 URL 수정 대화상자 표시
    - 링크 텍스트 수정 옵션 제공
    - URL 유효성 검사 (잘못된 형식 시 경고)
  - **Alt+클릭으로 링크 삭제**
    - 링크 제거 (텍스트는 유지)
    - 확인 대화상자 표시
  - **우클릭 컨텍스트 메뉴**
    - 링크 수정 (더블클릭 단축키 표시)
    - URL 복사 (클립보드에 복사)
    - 새 탭에서 열기
    - 링크 제거 (Alt+클릭 단축키 표시)
    - 다크 모드 지원
    - 페이드인 애니메이션 효과
  - **링크 목록 조회 기능**
    - `getAllLinks()` 메서드 추가
    - 문서 내 모든 링크의 텍스트와 URL 반환
  - **선택 영역 자동 저장**
    - 편집 모드에서 텍스트 선택 시 자동 저장
    - 5초 후 자동 만료
    - 링크/이미지/테이블 삽입 시 저장된 선택 영역 사용
    - 선택 영역 저장 시 토스트 메시지 표시

### 💄 스타일/UI 개선 (UI/UX)
- **링크 스타일 추가**
  - 기본 링크: 파란색 밑줄 (#3b82f6)
  - 호버 효과: 진한 파란색 (#1d4ed8)
  - 방문한 링크: 보라색 (#7c3aed)
  - 다크 모드 지원 (밝은 파란색 계열)
- **편집 모드에서 링크 강조**
  - 반투명 파란색 점선 테두리
  - 호버 시 배경색 변경
  - 링크가 편집 가능함을 시각적으로 표시
- **편집 패널 사용 방법 안내**
  - 텍스트 선택 후 포맷 적용 안내
  - 링크 관리 단축키 안내 (더블클릭/Alt+클릭/우클릭)
  - 파란색 배경의 정보 박스로 표시
- **링크 삽입 시 툴팁 추가**
  - 링크에 마우스를 올리면 사용 방법 표시
  - "더블클릭: 수정 | Alt+클릭: 삭제 | 우클릭: 메뉴" 안내

### 🔧 개선됨 (Improved)
- **링크 삽입 기능 개선**
  - 선택 영역이 해제되어도 저장된 선택 영역 사용
  - 이미지/테이블 삽입에도 동일한 선택 영역 저장 로직 적용
  - 삽입 후 선택 영역 자동 초기화

---

## [v0.2.4.10] - 2026-02-01

### 🐛 수정됨 (Fixed)
- **ERR_CONNECTION_REFUSED 에러 메시지 제거**
  - 외부 디버깅 서비스(`http://127.0.0.1:7242`) 사용 가능 여부를 1회만 체크
  - 서비스가 사용 불가능하면 fetch 호출 자체를 하지 않아 콘솔 에러 제거
  - `ContentRenderer.js`와 `viewer.js`에 조건부 로그 전송 로직 추가
- **편집 기능 개선**
  - 제목, 인용, 코드, 목록 변환 시 마크다운 문법 텍스트 대신 실제 HTML 요소로 삽입
  - 링크 삽입 시 실제 `<a>` 태그로 삽입 (마크다운 문법 아님)
  - 이미지 삽입 시 실제 `<img>` 태그로 삽입 (마크다운 문법 아님)
  - 테이블 삽입 시 실제 `<table>` HTML 구조로 삽입 (마크다운 문법 아님)
  - 모든 편집 기능에 편집 모드 체크 및 히스토리 저장 기능 추가

### 💄 스타일/UI 개선 (UI/UX)
- **읽기 진행률 표시 상자 테두리 제거**
  - `reading-stats-container`의 테두리(`border theme-border`) 제거
  - 더 깔끔한 UI 제공
- **상단 버튼 색상 개선**
  - 모든 버튼을 파스텔톤 색상으로 변경 (`bg-*-200` 계열)
  - 버튼 배경색 채도 낮춤 (더 부드러운 느낌)
  - 모든 버튼 텍스트 색상을 `text-gray-800`으로 통일
  - 줄바꿈 버튼 hover 색상 수정 (더 연한 색상으로 변경)

---

## [v0.2.4.9] - 2026-02-01

### ✨ 추가됨 (Added)
- **편집 기능 대폭 개선**
  - **편집 모드 시스템**
    - 편집 패널 열 때 자동으로 `contentEditable` 활성화
    - 편집 중인 영역에 파란색 점선 테두리 표시
    - 편집 패널 닫을 때 저장 여부 확인 대화상자
  - **편집 히스토리 시스템**
    - 0.5초마다 변경사항을 히스토리에 자동 저장
    - 최대 50개 편집 상태 유지
    - 중간 상태에서 편집 시 새로운 분기 생성
  - **실행 취소/다시 실행 기능**
    - Ctrl+Z: 이전 상태로 되돌리기 (최대 50단계)
    - Ctrl+Y 또는 Ctrl+Shift+Z: 다시 실행
    - 토스트 알림으로 현재 상태 표시 ("↩️ 실행 취소 (3/10)" 형식)
  - **키보드 단축키**
    - Ctrl+Z: 실행 취소
    - Ctrl+Y 또는 Ctrl+Shift+Z: 다시 실행
    - Ctrl+S: 저장
    - Esc: 편집 모드 종료
  - **토스트 알림 시스템**
    - 성공 메시지: "✨ bold 적용됨"
    - 경고 메시지: "⚠️ 텍스트를 먼저 선택하세요"
    - 2초 후 자동 사라짐 (fadeInOut 애니메이션)
  - **저장 기능**
    - HTML → 마크다운 자동 변환
    - 파일 객체 업데이트
    - 다운로드 권장 안내

### 🎨 개선됨 (Improved)
- **편집 컨트롤 버튼 추가**
  - 편집 패널 상단에 컨트롤 버튼 그룹 추가
  - 실행 취소/다시 실행 버튼 (↩️/↪️)
  - 저장/취소 버튼 (💾/❌)
  - 버튼에 키보드 단축키 툴팁 표시
- **편집 모드 시각적 피드백**
  - 편집 중 버튼 색상 변경 (파란색 → 빨간색)
  - 버튼 텍스트 변경 ("편집" → "편집 중...")
  - contentEditable 영역에 포커스 표시

---

## [v0.2.4.8] - 2026-02-01

### ✨ 추가됨 (Added)
- **편집 메뉴 서브메뉴**
  - 우클릭 컨텍스트 메뉴에 "편집" 항목 추가
  - Google Docs 스타일 계층형 서브메뉴 구조
  - 호버 시 자동 표시 (slideInRight 애니메이션)
  - 서브메뉴 항목: 복사(Ctrl+C), 잘라내기(Ctrl+X), 붙여넣기(Ctrl+V), 전체 선택(Ctrl+A)
  - 키보드 단축키 표시
  - 라이트/다크 모드 대응

### 🎨 개선됨 (Improved)
- **서브메뉴 UX 개선**
  - 0.15초 슬라이드 애니메이션
  - 호버 시 배경색 변경
  - 자연스러운 전환 효과

---

## [v0.2.4.7] - 2026-02-01

### ✨ 추가됨 (Added)
- **킨들 스타일 읽기 진행률 표시**
  - 좌측 하단에 현재 위치(0-1000)와 퍼센트(0-100%) 실시간 표시
  - 스크롤에 따라 자동 업데이트
  - 설정 패널에서 ON/OFF 토글 가능
  - localStorage에 설정 저장 (페이지 새로고침 시에도 유지)
  - 기본값: 표시(ON)

- **앱 정보 자동 숨김 기능**
  - 중앙 하단의 앱 정보(버전 번호)가 스크롤 다운 시 자동 숨김
  - 스크롤 업 시 다시 나타남
  - 0.5초 부드러운 fade 효과

### 🎨 개선됨 (Improved)
- **설정 토글 크기 통일**
  - "읽기 진행률 표시" 토글을 다른 토글(w-7 h-4)과 동일한 크기로 변경
  - 일관된 UI 경험 제공

- **읽기 진행률 배경색 개선**
  - 반투명 배경(`bg-white/95`)에서 테마 배경(`theme-panel-bg`)으로 변경
  - 테마별 자동 배경색 적용 (라이트: 흰색, 다크: 회색, 세피아: 베이지, 그린: 연두)
  - 구분선 색상도 테마에 맞게 조정 (`theme-text-body opacity-30`)

### 🐛 수정됨 (Fixed)
- **UI 전환 실패 문제 해결**
  - HTML 구조상 `mainContent`가 `page-upload` 내부에 있어 부모를 숨기면 자식도 숨겨지는 문제 해결
  - `uploadAreaContainer`만 `-translate-y-full`로 화면 밖으로 이동하도록 수정
  - `mainContent` 명시적 표시 (`display: block`, `visibility: visible`, `opacity: 1`)
  - 토글 버튼 아이콘(▼)과 텍스트("패널 펼치기") 동기화

- **파일명 미표시 문제 해결**
  - `#updateFileNameDisplay()` 함수 추가
  - `currentFileName` 요소에 파일명 표시
  - `fileInfo` 요소에 파일 크기 및 글자 수 표시

- **하이라이트 복원 기능 추가**
  - `#calculateTextIndices()` 메서드로 정확한 텍스트 위치(startIndex/endIndex) 계산
  - `#saveHighlightData()` 함수에 위치 정보 저장 로직 추가
  - `restoreHighlights()` 메서드로 파일 재업로드 시 하이라이트 자동 복원
  - `#applyHighlight()` 메서드로 TreeWalker API 사용하여 정확한 위치 복원
  - 위치 정보가 없는 하이라이트 필터링 (기존 데이터 호환성)
  - 뒤에서부터 복원하여 인덱스 변경 방지

### 🔧 개선됨 (Improved)
- **디버깅 로그 개선**
  - UI 전환 과정 로그 추가 (🔄, ✅, 🎉 이모지 사용)
  - 하이라이트 저장/복원 과정 로그 추가 (💾, 🎨, ✅ 이모지 사용)
  - 에러 발생 시 명확한 경고 메시지 출력

### 📝 문서화 (Documentation)
- `docs/03_troubleshooting/2026-02-01_UI_전환_실패.md` 추가
- 문제 분석 및 해결 과정 상세 기록

---

## [v0.2.4.5] - 2026-01-30

### ✨ 추가됨 (Added)
- **텍스트 하이라이트(형광펜) 시스템 구현**
  - `HighlightManager.js` 모듈 신설 (하이라이트 저장, 삭제, 데이터 관리)
  - 컨텍스트 메뉴에 형광펜 색상 팔레트(5색) UI 추가
  - 텍스트 선택 후 우클릭하여 하이라이트 적용 기능 연결
  - 하이라이트된 영역 우클릭 시 '삭제' 기능 구현

### 🐛 수정됨 (Fixed)
- **AI 텍스트 변환 오류 수정**
  - Google Gemini API 모델명 변경 (`gemini-2.0-flash` 적용, 단종된 `exp` 모델 제거)
  - 변환 완료 후 파일 확장자가 `.txt`로 남아 렌더링되지 않던 문제를 `.md` 강제 변환으로 수정
  - 파일 로드 시 `file.content` 메모리 누락 문제 해결
- **다운로드 기능 오류 수정**
  - `ViewerCoordinator`에 누락되었던 `getCurrentFileName` 메서드 추가
- **컨텍스트 메뉴 버그 수정**
  - 메뉴 HTML 구조 깨짐(중첩 태그 오류) 수정
  - 하이라이트 위에서 우클릭 시 일반 메뉴(북마크 등)가 사라지는 로직 수정 (Toggle 로직 개선)
- **🐛 긴급 수정 (Hotfix)**
  - **파일 저장 기능 정상화**
    - 상단 툴바의 'MD 저장' 버튼(`downloadMdBtn`) 클릭 시 0바이트(빈 파일)로 저장되던 문제 해결
    - 기존 저장 버튼 이벤트를 `viewer.downloadCurrentFile()` 메서드로 재연결하여 메모리 내 최신 데이터를 저장하도록 수정
  - **뷰어 초기화 오류 수정**
    - `ViewerCoordinator` 생성자에서 `window.viewer` 전역 인스턴스 할당 누락 수정 ("뷰어가 초기화되지 않았습니다" 오류 해결)
  - **HTML 구조 및 중복 ID 정리**
    - `ebook_viewer.html`: 컨텍스트 메뉴 내 중복된 `ctxRemoveHighlight` 버튼 제거
    - '커스텀 메뉴 사용' 토글 스위치가 컨텍스트 메뉴 영역 밖으로 이탈해 있던 HTML 구조 수정

### 💄 스타일/UI 개선 (UI/UX)
- **마크다운 가독성 개선**
  - `StyleManager.js`: 제목(H1)과 서지 정보(H3)의 크기 배율을 조정하여 시각적 계층 구조 강화
- **다크 모드 가독성 개선**
  - 컨텍스트 메뉴에 다크 모드 텍스트 색상(`dark:text-gray-200`)을 명시하여 글씨가 안 보이는 문제 해결

---

## [v0.2.4.4] - 2026-01-30

### ✨ 추가됨 (Added)
- **커스텀 컨텍스트 메뉴 기능 구현**
  - 우클릭 시 커스텀 메뉴 표시 기능 추가
  - `setupContextMenuListener()`: 컨텍스트 메뉴 이벤트 리스너 등록 함수
  - `handleContextMenu()`: 우클릭 이벤트 처리 함수 (Ctrl+우클릭 지원)
  - `hideContextMenu()`: 메뉴 숨기기 함수
  - `handleMouseUp()`: 텍스트 선택 영역 자동 저장 함수
  - `setupContextMenuItems()`: 메뉴 항목 클릭 이벤트 설정 함수

### 🔧 개선됨 (Improved)
- **컨텍스트 메뉴 설정 함수 개선**
  - `toggleContextMenuSetting()`: 설정 변경 시 리스너 자동 재등록
  - `restoreContextMenuSetting()`: 두 토글 동기화 및 설정 복원 개선
  - 설정 패널과 컨텍스트 메뉴의 토글이 완전히 동기화됨

### 🎯 기능
- **커스텀 메뉴 항목**
  - 북마크 추가: 현재 위치에 북마크 추가
  - 각주/메모 달기: 준비 중 (알림 표시)
  - 텍스트 공유: 선택한 텍스트를 클립보드에 복사
  - 뷰어 설정: 설정 패널 열기
  - 패널 펼치기: 업로드 섹션 토글
  - 하이라이트 삭제: 하이라이트된 텍스트 제거
  - 형광펜 팔레트: 5가지 색상 선택 (준비 중)

- **Ctrl + 우클릭 지원**
  - Windows/Linux: Ctrl + 우클릭 → 브라우저 기본 메뉴
  - Mac: Cmd + 우클릭 → 브라우저 기본 메뉴
  - 커스텀 메뉴와 브라우저 메뉴를 모두 사용 가능

- **조건부 활성화**
  - 설정에 따라 커스텀 메뉴 활성/비활성 가능
  - 비활성 시 브라우저 기본 메뉴 사용

### 🐛 수정됨 (Fixed)
- **커스텀 메뉴 작동 안 함 문제 해결**
  - 이벤트 리스너가 등록되지 않아 메뉴가 표시되지 않던 문제 해결
  - `main.js`의 `initApp()`에서 `setupContextMenuListener()` 호출 추가
  - 모든 메뉴 항목에 클릭 이벤트 리스너 연결

---

## [v0.2.4.3] - 2026-01-30

### 🐛 수정됨 (Fixed)
- **로컬 파일 로딩 오류 해결**
  - `HistoryManager.js` 119번째 줄: `fileKey`가 `null`인 경우 처리 추가
  - 히스토리 데이터에 `fileKey: null`인 항목이 있어 `TypeError` 발생하던 문제 해결
  - null 체크 추가로 앱 초기화 중단 문제 해결
  - 파일 선택 기능 정상 작동하도록 수정

**기술적 세부사항:**
- `item.fileKey.startsWith('gdrive_')` → `item.fileKey ? item.fileKey.startsWith('gdrive_') : false`
- 구버전 데이터 호환성 개선
- 방어적 프로그래밍 패턴 적용

---

## [v0.2.4.2] - 2026-01-30

### 🐛 수정됨 (Fixed)
- **Google Drive 버튼 오류 수정**
  - `ebook_viewer.html` 71번째 줄: Google Drive 버튼에 `onclick="loadGoogleDriveFiles()"` 속성 추가
  - 버튼 클릭 시 함수 호출되지 않던 문제 해결
  - HTML onclick과 JavaScript 함수 연결 완료

**원인:**
- 이전 버전에서 이벤트 리스너 등록 코드가 누락됨
- onclick 속성도 없어 버튼이 완전히 작동하지 않음

**해결:**
- HTML onclick 속성 추가로 즉시 실행 가능하도록 수정
- 다른 버튼들과 일관된 방식으로 통일

---

## [v0.2.4.1] - 2026-01-30

### 🐛 수정됨 (Fixed)
- **모듈 import 오류 수정**
  - `main.js`의 import 문에서 누락된 `toggleBookmark` 추가
  - 모든 export 함수가 올바르게 import되도록 수정
  - 디버깅 코드 8개 제거 (fetch 호출)
  - 깨끗한 프로덕션 코드로 정리

- **viewer.js 함수 추가**
  - `downloadAsMarkdown()`: 마크다운 파일 다운로드 기능
  - `handleAIClean()`: AI 텍스트 변환 기능
  - `toggleFavorite()`: 즐겨찾기 토글
  - `resetAllSettings()`: 모든 설정 초기화
  - `exportData()` / `importData()` / `handleImportDataFile()`: 데이터 백업/복원
  - `restoreContextMenuSetting()` / `toggleContextMenuSetting()`: 컨텍스트 메뉴 설정

- **경로 구조 최적화**
  - 깃허브 레포지토리 구조에 맞게 폴더 구조 재정리
  - `src/js/modules/` 폴더에 클래스 모듈 배치
  - 모든 import 경로 검증 및 수정

### ✨ 추가됨 (Added)
- **테스트 도구**
  - `test_modules.html`: 모듈 로딩 테스트용 HTML
  - `TEST_CHECKLIST.md`: 상세한 테스트 체크리스트
  - 6단계 테스트 프로세스 문서화

- **문서화 개선**
  - `GITHUB_DEPLOY_GUIDE.md`: GitHub Pages 배포 가이드
  - `QUICKSTART.md`: 3단계 빠른 시작 가이드
  - `FIXED_REPORT_V2.md`: 상세한 수정 보고서
  - `DEV_NOTE.md`: 개발 규칙 및 트러블슈팅 가이드
  - 트러블슈팅 가이드 추가

### ♻️ 변경됨 (Changed)
- **main.js 개선**
  - window 객체에 모든 함수 올바르게 할당
  - HTML onclick 이벤트와 완벽 연결
  - 불필요한 디버깅 로그 제거

- **viewer.js 개선**
  - 동적 import를 사용한 지연 로딩
  - AI 서비스 및 유틸리티 함수 on-demand 로딩
  - 메모리 효율성 개선

### 📝 문서화 (Documentation)
- 클래스 기반 모듈 구조 설명 추가
- ES6 모듈 시스템 사용법 문서화
- 디버깅 전략 및 체크리스트 작성
- 개발 워크플로우 가이드 추가

---

## [v0.2.4] - 2026-01-30

### 🔧 리팩토링 (Refactored)
- **클래스 기반 모듈 구조 채택**
  - 에이전트 1 (클래스 기반 모듈 패턴)을 메인 구현으로 채택
  - `ViewerCoordinator` 클래스로 모든 관리자 클래스 통합
  - 각 기능별 독립된 클래스 모듈 (`src/js/modules/` 폴더)
  - 단일 책임 원칙(SRP) 준수
  - 싱글톤 패턴으로 인스턴스 관리

### ✨ 추가됨 (Added)
- **누락된 함수 추가**
  - `downloadAsMarkdown()`: 마크다운 파일 다운로드
  - `handleAIClean()`: AI 변환 처리
  - `toggleFavorite()`: 즐겨찾기 토글
  - `resetAllSettings()`: 모든 설정 초기화
  - `exportData()` / `importData()` / `handleImportDataFile()`: 데이터 백업/복원
  - `restoreContextMenuSetting()` / `toggleContextMenuSetting()`: 컨텍스트 메뉴 설정

### 🗑️ 제거됨 (Removed)
- 중복된 `src/js/viewer/` 폴더 제거
- 사용하지 않는 에이전트 제안 파일 삭제 (agent2, agent3)
- 관련 테스트 스크립트 및 문서 정리
- `viewer.js.backup` 파일 제거

### 📝 문서화 (Documentation)
- `PROJECT_BRIEF.md` 업데이트: 클래스 기반 구조 반영
- 프로젝트 구조 문서화 개선

---

## [v0.2.3.2] - 2026-01-02

### 🔧 개선됨 (Improved)
- **하이라이트 기능 개선**
  - 하이라이트 클릭 시 자동으로 텍스트 선택되어 색상 변경 가능
  - 텍스트 선택 영역 자동 저장 (mouseup 이벤트)
  - 하이라이트 적용 시 에러 처리 강화

- **컨텍스트 메뉴 개선**
  - 커스텀 메뉴 비활성화 시 브라우저 기본 메뉴 정상 표시
  - Ctrl + 우클릭 (Mac: Cmd + 우클릭)으로 브라우저 기본 메뉴 접근 가능
  - 설정 패널과 컨텍스트 메뉴의 토글 동기화
  - 토글 클릭 시 즉시 UI 업데이트

- **파일 출처 시각적 구분**
  - 히스토리 목록에서 Google Drive 파일과 로컬 파일 구분 (색상, 뱃지)
  - 북마크 목록에서 파일 출처 구분 (아이콘, 색상)
  - Google Drive: 파란색 + "Drive" 뱃지
  - 로컬 파일: 회색 + "Local" 뱃지

### 🐛 수정됨 (Fixed)
- 존재하지 않는 `showLocalFileResumeMessage` 함수 호출 제거
- 컨텍스트 메뉴 닫을 때 `activeHighlightSpan` 초기화

---

## [v0.2.3] - 2025-12-26

### ✨ 추가됨 (Added)
- **텍스트 하이라이트 기능**
  - 우클릭 메뉴에서 형광펜 색상 선택 (노랑, 초록, 파랑, 분홍, 보라)
  - 여러 줄에 걸친 텍스트 하이라이트 지원 (TreeWalker API 사용)
  - 하이라이트 클릭 시 수정/삭제 메뉴 표시
  - 하이라이트 색상 변경 기능
  - 하이라이트 정보 자동 저장 및 복구 (localStorage)
  - 파일 열기 시 저장된 하이라이트 자동 복원

- **데이터 백업 및 복원 기능**
  - 북마크, 히스토리, 하이라이트, 설정 등을 JSON 파일로 내보내기
  - JSON 파일을 불러와서 데이터 복원
  - 읽기 위치 정보도 함께 백업/복원
  - 설정 패널에서 "데이터 백업 & 복원" 섹션 추가

- **우클릭 메뉴 개선**
  - 형광펜 팔레트 추가 (5가지 색상)
  - 하이라이트 삭제 메뉴 추가 (하이라이트 클릭 시 표시)
  - 패널 펼치기 버튼 추가 (상단 패널을 빠르게 열기)
  - 메뉴 모드 토글 (일반 모드 / 수정 모드)

### ♻️ 변경됨 (Changed)
- **하이라이트 저장 구조 개선**
  - 파일별 하이라이트 데이터 분리 저장 (`ebook_highlights`)
  - 하위 호환성을 위해 기존 `textHighlights` 형식도 유지
  - 오프셋 기반 정확한 위치 저장 및 복원

- **컨텍스트 메뉴 동작 개선**
  - 하이라이트 클릭 시 수정 모드로 전환
  - 일반 텍스트 선택 시 일반 모드로 동작
  - 메뉴 항목 동적 표시/숨김

### 🐛 수정됨 (Fixed)
- **하이라이트 복원 안정성 개선**
  - 뒤에서부터 복원하여 인덱스 변경 방지
  - 오프셋 정보가 없는 하이라이트 필터링
  - 복원 실패 시 경고 메시지 출력

---

## [v0.2.2] - 2025-12-26

### ✨ 추가됨 (Added)
- **북마크 및 히스토리 개별 삭제 기능**
  - 각 히스토리 항목에 삭제 버튼 추가 (호버 시 표시)
  - 각 북마크 항목에 삭제 버튼 추가 (호버 시 표시)
  - 삭제 확인 다이얼로그로 실수 방지
  - 삭제 후 목록 즉시 갱신

- **텍스트 스트로크(외곽선 두께) 조절 기능**
  - 본문 스타일 섹션에 스트로크 조절 슬라이더 추가
  - 0px ~ 1.5px 범위에서 조절 가능 (0.05px 단위)
  - 얇은 폰트를 진하게 만드는 효과
  - `-webkit-text-stroke-width` 및 `currentColor` 사용

### ♻️ 변경됨 (Changed)
- **북마크 목록 개선**
  - 모든 파일의 북마크를 통합하여 최신순 정렬
  - 현재 열린 파일의 북마크만 표시하도록 변경
  - 북마크 클릭 시 파일 열기 대신 현재 파일 내 위치로 이동

- **히스토리 목록 개선**
  - 최신순 정렬 (timestamp 기준 내림차순)
  - 최근에 읽은 파일이 목록 상단에 표시

- **마크다운 헤더 폰트 스타일 개선**
  - 동적 스타일 태그 주입 방식으로 변경
  - `!important`를 사용하여 Tailwind `.prose` 클래스 우선순위 우회
  - 제목 폰트가 확실하게 적용되도록 개선

### 🐛 수정됨 (Fixed)
- **북마크 저장 시 파일 인식 개선**
  - `currentFileKey`가 없어도 본문 내용이 있으면 임시 파일 정보 생성
  - Google Drive 파일 등 다양한 상황에서 북마크 저장 안정성 향상

---

## [v0.2.1] - 2025-12-26

### ✨ 추가됨 (Added)
- 뷰어 너비 조절 기능 (슬라이더, 꽉 찬 화면 모드)
- 본문 스타일 커스터마이징 (줄간격, 글씨체, 색상)
- 설정 초기화 기능
- 한글 웹폰트 추가 (고운 바탕, 고운 도움, IBM Plex Sans KR, 리디바탕)
- 커스텀 컨텍스트 메뉴 (우클릭 메뉴)
- 히스토리 및 북마크 목록 압축 (높이 및 간격 축소)

### 🐛 수정됨 (Fixed)
- 뷰어 너비 조절 버그 (CSS 우선순위 문제 해결)
- 줄간격 적용 버그 (`updateBodyStyles()` 함수 구현)
- 레이아웃 개선 (너비 제한 제거)

### ♻️ 변경됨 (Changed)
- UI 개선 (기능 버튼 그룹을 상단 패널 헤더로 이동)
- 설정 패널 레이아웃 통합 (단일 회색 패널로 변경)
- 상단 패널을 드로어 형태로 변경

---

## [v0.2.0] - 2025-12-26

### 🐛 수정됨 (Fixed)
- **파일 선택 버튼 동작 문제 해결**
  - `main.js`: DOM 요소 ID 불일치 수정 (`getElementById` 타겟을 `fileInput`에서 `file-input`으로 변경)
  - `viewer.js`: DOM 요소 ID 불일치 수정 (`getElementById` 타겟을 `fileInput`에서 `file-input`으로 변경)
  - `ebook_viewer.html`: 파일 입력 요소 ID를 `fileInput`에서 `file-input`으로 변경
  - `ebook_viewer.html`: 파일 선택 버튼(`#selectFilesBtn`)에 `onclick="document.getElementById('file-input').click()"` 속성 추가
  - `ebook_viewer.html`: Google Drive 버튼(`#loadGoogleDriveBtn`)에 `onclick="loadGoogleDriveFiles()"` 속성 추가
  - 이벤트 리스너 중복 등록 방지 로직 개선 (함수 참조 저장 방식으로 변경)

### ✨ 추가됨 (Added)
- **AI 변환 기능**
  - Google Gemini API를 통한 텍스트 마크다운 변환
  - AI 변환 버튼 추가 (🤖 AI 변환 & 저장)
  - 변환된 마크다운 파일 자동 다운로드
  - Gemini 1.5 Flash 및 2.0 Flash 모델 지원

- **마크다운 파일 지원**
  - `.md` 파일 읽기 및 렌더링 기능
  - marked.js를 통한 마크다운 HTML 변환
  - 마크다운 전용 스타일링 (`.markdown-mode`)
  - 코드 블록 래퍼 자동 제거 기능
  - 마크다운 파일 북마크 및 읽기 위치 저장 지원

- **API 키 관리**
  - Google Gemini API 키 저장 기능
  - 설정 패널에 API 키 입력 및 저장 버튼 추가

### ♻️ 변경됨 (Changed)
- **기능 개선**
  - 텍스트 정리 기능 제거 (AI 변환으로 대체)
  - 마크다운 렌더링 시 자동 줄바꿈 적용
  - 파일 선택 다이얼로그에 `.md` 확장자 추가

- **스타일링**
  - 마크다운 모드 전용 CSS 스타일 추가
  - 제목, 본문, 리스트 등 마크다운 요소 스타일링
  - 다크 모드에서의 마크다운 스타일 지원

### 🐛 수정됨 (Fixed)
- **Google Drive 통합**
  - `loadGoogleDriveFiles` 함수 전역 노출 문제 수정
  - Google Drive 불러오기 기능 정상 작동
  - Google Drive 피커에서 마크다운(.md) 파일 인식 문제 해결
    - `createPicker` 함수의 `view.setMimeTypes` 설정에서 MIME 타입 문자열 오류 수정
    - 오타 수정: `application/octet-stream.folder` -> `application/octet-stream,application/vnd.google-apps.folder` (콤마 누락 수정 및 폴더 MIME 타입 명시)
    - 이제 구글 드라이브에서 .md 파일 인식 및 폴더 탐색이 정상적으로 작동함

- **파일 처리**
  - 드래그 앤 드롭 시 `.md` 파일 필터링 추가
  - 마크다운 파일 렌더링 후 스크롤 위치 복원 개선

### 🗑️ 제거됨 (Removed)
- 텍스트 정리 기능 및 관련 버튼 제거
- `cleanUpText` 함수 사용 중단

---

## [v0.1.0] - 2025-12-24

### ✨ 추가됨 (Added)
- **Google Drive 통합**
  - Google Drive 파일 탐색 및 열기 기능
  - Google Picker API를 통한 파일 선택
  - 폴더 탐색 지원 (더블클릭으로 하위 폴더 이동)
  - Google Drive 파일 자동 로드 기능 (마지막 읽은 파일 복원)

- **파일 관리 기능**
  - 로컬 파일 업로드 및 드래그 앤 드롭 지원
  - 파일 히스토리 저장 및 표시
  - 북마크 기능 (현재 위치에 북마크 추가/삭제)
  - 읽기 진행 상황 자동 저장 (스크롤 위치)
  - 마지막 읽은 파일 이어보기 기능

- **사용자 인터페이스**
  - 프로젝트 랜딩 페이지 (`index.html`) 추가
  - 테마 변경 기능 (라이트, 다크, 세피아, 그린)
  - 폰트 크기 조절 기능
  - 반응형 디자인 지원

- **설정 관리**
  - Google Drive API 설정 저장/불러오기
  - 사용자 설정 localStorage 저장
  - 버전 정보 중앙 관리 (`src/js/config.js`)

### ♻️ 변경됨 (Changed)
- **코드 구조 개선**
  - 모놀리식 코드 구조를 ES6 모듈로 리팩토링
  - CSS와 JavaScript를 별도 파일로 분리
  - 기능별 모듈 분리:
    - `utils.js`: 유틸리티 함수
    - `settings.js`: 설정 및 상태 관리
    - `google_drive.js`: Google Drive 통합
    - `viewer.js`: 뷰어 기능
    - `main.js`: 초기화 및 진입점
    - `config.js`: 버전 및 설정 정보

- **파일 구조 최적화**
  - HTML 파일 크기 감소 (700줄 → 131줄, 81% 감소)
  - CSS 파일 분리 (`src/css/styles.css`)
  - JavaScript 모듈화 (5개 모듈)

- **데이터 관리**
  - File Key 기반 파일 식별 시스템
  - Google Drive 파일: `gdrive_{fileId}` 형식
  - 로컬 파일: `local_{fileName}_{fileSize}` 형식
  - localStorage를 통한 데이터 영구 저장

### 🐛 수정됨 (Fixed)
- **localStorage 연동**
  - 히스토리 및 북마크 저장/불러오기 기능 수정
  - JSON.stringify를 통한 안전한 데이터 저장
  - 앱 초기화 시 데이터 자동 복원

- **이어보기 기능**
  - Google Drive 파일 자동 로드 로직 개선
  - 로컬 파일 안내 메시지 표시
  - 스크롤 위치 정확한 복원

### 📝 문서화
- `README.md`: 프로젝트 소개 및 실행 방법
- `CHANGELOG.md`: 버전별 변경 이력
- `docs/REFACTORING.md`: 리팩토링 작업 상세 내역
- `docs/REFACTORING_SUMMARY.md`: 리팩토링 요약
- `docs/local_server_setup.md`: 로컬 서버 구동 가이드
- `docs/google_oauth_setup_guide.md`: Google OAuth 설정 가이드
- `docs/google_drive_architecture.md`: Google Drive 통합 아키텍처

### 🔧 기술 스택
- **프론트엔드**: HTML5, CSS3, JavaScript (ES6 Modules)
- **스타일링**: Tailwind CSS
- **API 통합**: Google Drive API, Google Picker API
- **인증**: Google Identity Services (OAuth 2.0)
- **저장소**: localStorage

---

## 버전 관리 규칙

### 버전 형식
- `MAJOR.MINOR.PATCH` (예: `0.1.0`)
- **MAJOR**: 호환되지 않는 API 변경
- **MINOR**: 하위 호환성을 유지하는 기능 추가
- **PATCH**: 하위 호환성을 유지하는 버그 수정

### 변경 유형
- **✨ Added**: 새로운 기능 추가
- **♻️ Changed**: 기존 기능 변경
- **🐛 Fixed**: 버그 수정
- **🗑️ Removed**: 기능 제거
- **🔒 Security**: 보안 관련 변경
- **📝 Documentation**: 문서 변경

---

**참고**: 이전 버전의 변경 이력은 Git 히스토리에서 확인할 수 있습니다.

